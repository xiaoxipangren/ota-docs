# 系统管理指引

### 终端管理

##### 查看终端

![](/assets/Selection_004.png)

终端标签页列出了系统中注册的所有终端，选中终端可在下方查看终端的详细信息。在左侧的过滤器页中，可根据终端的状态进行过滤，如注册、失败、正在同步等。

##### 注册终端

注册设备的目的在于得到设备的唯一识别符controllerId及其鉴权令牌securityToken，然后将controllerId和securityToken通过一定机制写入设备的ROM中，设备才能正常与OTA服务器进行交互。设备注册后，系统会自动生成security token。

设备注册可通过手动添加和批量上传两种方式进行。

###### 手动添加

在系统概览的终端标签页的右上方点击“+”号，在弹出的“配置新终端”的对框中填写控制器ID、名称和说明后点击保按钮即可完成设备的手动添加。

![](/assets/device_create.png)

###### 批量上传

点击终端标签页的箭头符号，在弹出的“批量上传”的对话框中点击“上传”按钮，选择包含终端\(controllerId,name\)两列属性的csv文件即可。

![](/assets/device_upload.png)

##### 修改终端

选中终端后，点击编辑![](/assets/Selection_005.png)按钮，可修改终端的名称和说明。

##### 删除终端

选中终端拖动到下方的删除按钮，再进行确认处理可删除终端。

### 模块管理

##### 查看模块

![](/assets/Selection_006.png)

##### 新建模块

模块页点击"+"按钮，在弹出的对话框中，填写必要的模块信息，并选择合适的模块类型（模块类型应与更新类型相适应，如Application类型的模块就无法分配给OS Only类型的更新），保存即可。

#### ![](/assets/module_create.png)

##### 上传工件

模块定以后只有属性概念，而没有实质内容，还需要上传其对应的工件。选定某一模块后点击下方的上传文件按钮即可。

![](/assets/artifact_upload.png)

##### 修改模块

模块定义后其类型、版本、名称都无法修改，但可修改其说明。

##### 删除模块

拖动要删除的模块至删除按钮完成删除。

### 模块类型管理

模块类型是约束模块内容类型的实体，如指定模块是OS或是Application抑或两者的组合。

##### 新建类型

点击模块管理页面根据类型过滤选项卡中的配置按钮，在弹出的对话框中选择创建类型，即可进行类型创建。

![](/assets/Selection_007.png)

##### 修改类型

在创建类型的对话框中选择更新类型，可修改指定的模块类型信息。

##### 删除类型

将模块类型拖动到删除按钮完成删除。

### 更新管理

##### 查看更新

![](/assets/Selection_008.png)

##### 新建更新

点击更新菜单，进入更新管理界面，在“更细选项卡”右上角点击“+“按钮，在弹出的”配置新的更新包“对话框中选择更新类型\(更新类型决定了可以包含的模块类型，如OS with app类型的更新可以包含Application类型的模块，而OS类型只能包含OS类型的模块\)、填写更新名称和版本，点击保存完成更新定义。

![](/assets/distribution_create.png)

##### 分配模块

当更新和模块都定义完成后，还需要明确其之间的包含关系。还是在更新管理界面，通过拖动模块条目到更新条目上可完成将一个模块分配给更新，如果两者类型不符，将提示无法进行操作。分配完成后，点击更新，可以看到属于其的模块显示为绿色，否则为紫色。![](/assets/Selection_009.png)

##### 修改更新

点击编辑按钮，可修改更新的类型、版本号、名称等信息。

##### 删除更新

拖动要删除的更新至删除按钮。

### 更新类型管理

更新是模块的集合，相应的更新类型也是模块类型的集合。

##### 新建类型

点击更新管理页面的按类型过滤选项卡的配置按钮，在弹出的配置类型对话框中，选择创建类型，填写名称说明，并在右侧选择要包含的模块类型。

![](/assets/Selection_010.png)

##### 修改类型

在配置类型对话框中选择更新类型，可修改相应的更新类型。

##### 删除类型

拖动要删除的类型至删除按钮。

### 终端过滤器管理

##### 新建过滤器

点击过滤器管理页面右上角的"+"号，在弹出的对话框中填写过滤器名称和过滤器规则。

![](/assets/Selection_011.png)

过滤器的规则如下：

基本的过滤器格式是：字段 &lt;基本运算符&gt; 值 &lt;组合运算符&gt;

* 字段：待过虑资源的属性名
* 值：相应的属性值
* 基本运算符：简单查询运算符，支持以几种：

  * ==：等于
  * !=：不等于
  * =IN=：属于某一集合，如"name=IN=\(target1,target2\)

组合运算符：

* and
* or
* 通配符 \*

过滤器示例：

| 查询 | 说明 |
| :--- | :--- |
| updatestatus==error | 查询处于error状态的终端设备 |
| controllerId!=192.168.2.42 | 查询controllerId不是192.168.2.42的所有终端 |
| name==\*CCU\* | 查询名称中包含CCU的所有终端 |
| name==\*CCU\* or description==\*CCU\* | 查询名称中或者描述中包含CCU的所有终端 |
| name==\*SHC\* and description==\*SHC\* | 查询名称中和描述中都包含SHC的终端 |
| name==CCU\* and updatestatus==pending | 查询名称以CCU开头并且处于挂起状态的终端 |
| \(assignedds.name==‘ECU-DS’ and description==test\) or updatestatus!=error | 查询被分配了名称为ECU-DS的更新且描述为test的终端或者更新状态不是error的终端 |
| \(updatestatus!=In\_sync or updatestatus!=error\) and name==\*SHC1\* | 查询名称包含SHC1且更既不是In\_sync也不是error的终端 |
| \(updatestatus!=error or updatestatus!=pending\) and \(name==\*CCU\* or description==\*CCU\*\) | 查询名称或者描述中包含CCU且更新状态既不是error也不是pending的终端 |

##### 修改过滤器

在过滤器列表中点击想要修改的过滤器，即可进入编辑界面。

##### 删除过滤器

拖动要删除的过滤器至删除按钮。

### 推送管理

当更新和终端过滤器都定义之后，就可以将两者结合起来组成一个推送，前者作为推送内容，后者作为推送的接受目标。

##### 新建推送

点击推送管理右上角的"+"号，弹出如下对话框：![](/assets/Selection_012.png)

填写推送名称，选择前面建立的更新和目标过滤器，右侧会显示过滤器中包含了多少终端会接收到更新。其他属性定义如下：

* 动作类型：指更新是软更新\(soft，可选择合适的时间升级\)或是强制更新\(forced，更新推送后立即执行\)，或者指定一个时刻，超过该时刻，更新会变成强制更新。
* 开始类型：推送在建立后是手动、自动、或者定时启动
* 分组：可以将终端过滤器指定的终端集合进一步划分成小组，以进行灰度发布：
  * 触发阈值：当一组中成功执行更新的设备占小组所有设备的比例超过该阈值后，说明该小组更新成功，将触发下一小组进行更新
  * 错误阈值：当小组中失败的终端设备比率或个数超过该阈值，说明该小组更新失败，将触发紧急操作
  * 分组方法：
    * 按组数均分：每个小组将包括同样设备总数/组数个设备
    * 高级定义：使用过滤器进行精确分组

![](/assets/Selection_014.png)

##### 修改推送

在推送列表中点击编辑按钮。

##### 删除推送

在推送列表中点击删除按钮。

##### 复制推送

点击复制按钮可根据已有推送建立新推送。

##### 操纵推送

点击启动、暂停按钮可启动和暂停推送。





